# üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## –û–±–∑–æ—Ä

Telegram –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** —á–µ—Ä–µ–∑ Telegram Login Widget
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –æ –Ω–æ–≤—ã—Ö –ø–æ–¥–∫–∞—Å—Ç–∞—Ö –∏ —Å–µ—Å—Å–∏—è—Ö
- **Voice Chat** –¥–ª—è —Å–ª—É—à–∞—Ç–µ–ª–µ–π Live —Å–µ—Å—Å–∏–π
- **–ó–∞–ø–∏—Å–∏** —Å–µ—Å—Å–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–¥–∫–∞—Å—Ç–æ–≤

---

## –ë–æ—Ç—ã

### –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (@Podcast_FOMO_bot)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ò–Ω—Ç–µ—Ä–∞–∫—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

**–§–∞–π–ª:** `backend/telegram_bot.py`

**–ó–∞–ø—É—Å–∫:**
```bash
cd backend
python telegram_bot.py
```

### Recording Bot

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª–∞ @Podcast_F
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≥–æ–ª–æ—Å–æ–≤—ã—Ö —á–∞—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Å—Ç–æ–≤ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ

**–§–∞–π–ª:** `backend/telegram_recording_bot.py`

**–ó–∞–ø—É—Å–∫:**
```bash
cd backend
python telegram_recording_bot.py
```

---

## –ö–∞–Ω–∞–ª—ã

| –ö–∞–Ω–∞–ª | ID | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----|----------|
| @P_FOMO | -1002475795498 | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| @Podcast_F | -1003133850361 | –ó–∞–ø–∏—Å–∏ —Å–µ—Å—Å–∏–π |

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# backend/.env

# –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
TELEGRAM_BOT_TOKEN="8293451127:AAEVo5vQV_vJqoziVTDKHYJiOYUZQN-2M2E"
TELEGRAM_BOT_USERNAME="Podcast_FOMO_bot"

# –ö–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
TELEGRAM_NOTIFICATIONS_CHANNEL="P_FOMO"
TELEGRAM_NOTIFICATIONS_CHANNEL_ID="-1002475795498"

# –ö–∞–Ω–∞–ª –∑–∞–ø–∏—Å–µ–π
TELEGRAM_RECORDING_CHANNEL="Podcast_F"
TELEGRAM_RECORDING_CHANNEL_ID="-1003133850361"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ Channel ID

1. –î–æ–±–∞–≤–∏—Ç—å @userinfobot –≤ –∫–∞–Ω–∞–ª
2. –ü–µ—Ä–µ—Å–ª–∞—Ç—å –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ –±–æ—Ç—É
3. –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç ID –∫–∞–Ω–∞–ª–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-100`)

---

## Telegram Connect (–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

**URL:** `/settings/telegram`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram –∞–∫–∫–∞—É–Ω—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ

### Login Widget

```html
<!-- Telegram Login Widget -->
<script
  async
  src="https://telegram.org/js/telegram-widget.js?22"
  data-telegram-login="Podcast_FOMO_bot"
  data-size="large"
  data-radius="10"
  data-auth-url="https://your-domain.com/api/telegram/oauth/callback"
  data-request-access="write"
></script>
```

### OAuth Flow

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–∫–ª—é—á–∏—Ç—å Telegram"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
3. Telegram –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ callback URL
4. Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç telegram_chat_id –≤ –ø—Ä–æ—Ñ–∏–ª—å
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
```

---

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

| –¢–∏–ø | –ö–∞–Ω–∞–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `new_podcast` | –û–±—â–∏–π + –ª–∏—á–Ω—ã–π | –ù–æ–≤—ã–π –ø–æ–¥–∫–∞—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω |
| `live_starting` | –û–±—â–∏–π + –ª–∏—á–Ω—ã–π | Live —Å–µ—Å—Å–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è |
| `new_comment` | –õ–∏—á–Ω—ã–π | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –≤–∞—à–µ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É |
| `new_subscriber` | –õ–∏—á–Ω—ã–π | –ù–æ–≤—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ |
| `badge_awarded` | –õ–∏—á–Ω—ã–π | –í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–µ–π–¥–∂ |

### –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–í –∫–∞–Ω–∞–ª:**
```python
from services.telegram_service import send_channel_notification

await send_channel_notification(
    channel_id=TELEGRAM_NOTIFICATIONS_CHANNEL_ID,
    message="üéôÔ∏è –ù–æ–≤—ã–π –ø–æ–¥–∫–∞—Å—Ç: My Podcast",
    parse_mode="HTML"
)
```

**–õ–∏—á–Ω–æ–µ:**
```python
from services.telegram_service import send_personal_notification

await send_personal_notification(
    chat_id=user.telegram_chat_id,
    message="üí¨ –ù–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç @user"
)
```

---

## Recording Bot

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```
1. –ë–æ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –∫–∞–Ω–∞–ª @Podcast_F
2. –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞:
   a. –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª
   b. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ä–∞–∑–º–µ—Ä)
   c. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ /recordings/
   d. –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î podcasts
   e. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ @P_FOMO
```

### –ö–æ–¥

```python
# backend/telegram_recording_bot.py

from telegram.ext import Application, MessageHandler, filters
from motor.motor_asyncio import AsyncIOMotorClient
import os

async def handle_audio(update, context):
    """Handle incoming audio files"""
    message = update.message
    audio = message.audio or message.voice or message.document
    
    if audio:
        # Download file
        file = await context.bot.get_file(audio.file_id)
        file_path = f"/app/recordings/{audio.file_unique_id}.mp3"
        await file.download_to_drive(file_path)
        
        # Create podcast
        podcast = {
            "id": str(uuid.uuid4()),
            "title": f"Recording {datetime.now().strftime('%Y-%m-%d')}",
            "audio_url": f"/static/recordings/{audio.file_unique_id}.mp3",
            "duration": audio.duration,
            "source": "telegram_recording"
        }
        await db.podcasts.insert_one(podcast)
        
        # Send notification
        await send_notification(f"üéôÔ∏è –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å: {podcast['title']}")

def main():
    app = Application.builder().token(BOT_TOKEN).build()
    app.add_handler(MessageHandler(
        filters.AUDIO | filters.VOICE | filters.Document.AUDIO,
        handle_audio
    ))
    app.run_polling()
```

### –ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–µ—Ä–≤–∏—Å

```bash
# –°–æ–∑–¥–∞—Ç—å systemd service
sudo nano /etc/systemd/system/telegram-recording-bot.service
```

```ini
[Unit]
Description=Telegram Recording Bot
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/app/backend
ExecStart=/usr/bin/python3 telegram_recording_bot.py
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl enable telegram-recording-bot
sudo systemctl start telegram-recording-bot
```

---

## API Endpoints

```
GET  /api/telegram/bot-info           # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ
GET  /api/telegram/personal-status/{user_id}  # –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
POST /api/telegram/oauth/callback     # OAuth callback
POST /api/telegram/disconnect/{user_id}  # –û—Ç–∫–ª—é—á–∏—Ç—å Telegram
```

---

## –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `frontend/src/pages/TelegramSettings.jsx` | UI –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `frontend/src/components/TelegramConnect.jsx` | –í–∏–¥–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| `backend/routes/telegram.py` | API —Ä–æ—É—Ç—ã |
| `backend/services/telegram_service.py` | –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ |
| `backend/telegram_bot.py` | –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç |
| `backend/telegram_recording_bot.py` | Recording –±–æ—Ç |

---

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–æ—Ç –∞–¥–º–∏–Ω –∫–∞–Ω–∞–ª–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Channel ID (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `-100`)

### OAuth –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_BOT_USERNAME –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ callback URL –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ –≤ @BotFather
